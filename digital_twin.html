<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Mahindra - Smart Factory Digital Twin</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        :root {
            --primary: #1a3a5f;
            --secondary: #2c5aa0;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --light: #f5f7fa;
            --dark: #263238;
            --cyber-blue: #00b4d8;
            --cyber-green: #00ff88;
            --cyber-purple: #9d4edd;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            grid-template-areas: 
                "sidebar header"
                "sidebar main";
            min-height: 100vh;
        }
        
        .header {
            grid-area: header;
            background: rgba(15, 23, 42, 0.8);
            padding: 0 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .header h1 {
            color: var(--cyber-blue);
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header h1::before {
            content: "ü§ñ";
            font-size: 1.5rem;
        }
        
        .time-display {
            background: rgba(30, 41, 59, 0.7);
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .sidebar {
            grid-area: sidebar;
            background: rgba(15, 23, 42, 0.9);
            padding: 25px 0;
            box-shadow: 4px 0 12px rgba(0, 0, 0, 0.2);
            border-right: 1px solid rgba(100, 116, 139, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            padding: 0 25px 25px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
            margin-bottom: 25px;
        }
        
        .logo h2 {
            color: var(--cyber-green);
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo h2::before {
            content: "üè≠";
        }
        
        .nav-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .nav-section {
            margin-bottom: 25px;
        }
        
        .nav-section h3 {
            padding: 0 25px 15px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #94a3b8;
        }
        
        .nav-item {
            padding: 14px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(30, 41, 59, 0.5);
        }
        
        .nav-item.active {
            background: rgba(30, 41, 59, 0.8);
            border-left: 4px solid var(--cyber-blue);
            color: var(--cyber-green);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        .main-content {
            grid-area: main;
            padding: 25px;
            overflow-y: auto;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            margin-bottom: 25px;
            color: var(--cyber-blue);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title::after {
            content: "";
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, var(--cyber-blue), transparent);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(100, 116, 139, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .card h3 {
            margin-bottom: 20px;
            color: var(--cyber-green);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .kpi-good { color: var(--success); }
        .kpi-warning { color: var(--warning); }
        .kpi-bad { color: var(--danger); }
        .kpi-info { color: var(--cyber-blue); }
        
        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        
        .visualization-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .twin-container {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            height: 500px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        #factoryTwin {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background: #0a0f1a;
        }
        
        .controls-panel {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h4 {
            margin-bottom: 15px;
            color: var(--cyber-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(100, 116, 139, 0.3);
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--cyber-blue);
            cursor: pointer;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--cyber-blue);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-optimal { background: var(--success); }
        .status-warning { background: var(--warning); }
        .status-critical { background: var(--danger); }
        .status-offline { background: #94a3b8; }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid;
        }
        
        .alert-warning {
            background: rgba(255, 152, 0, 0.1);
            color: #ffb74d;
            border-left-color: var(--warning);
        }
        
        .alert-critical {
            background: rgba(244, 67, 54, 0.1);
            color: #ef9a9a;
            border-left-color: var(--danger);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .data-table th, .data-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        .data-table th {
            background: rgba(30, 41, 59, 0.5);
            font-weight: 600;
            color: var(--cyber-green);
        }
        
        .data-table tr:hover {
            background: rgba(30, 41, 59, 0.3);
        }
        
        .simulation-controls {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        .simulation-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.5);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-running { background: var(--success); animation: pulse 1.5s infinite; }
        .status-stopped { background: var(--danger); }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .machine-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(30, 41, 59, 0.5);
        }
        
        .machine-icon {
            font-size: 1.5rem;
        }
        
        .machine-info {
            flex: 1;
        }
        
        .machine-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .machine-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background: rgba(100, 116, 139, 0.3);
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        .progress-optimal { background: var(--success); }
        .progress-warning { background: var(--warning); }
        .progress-critical { background: var(--danger); }
        
        .scenario-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--cyber-purple);
        }
        
        .scenario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .scenario-title {
            font-size: 1.2rem;
            color: var(--cyber-green);
        }
        
        .test-results {
            margin-top: 15px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        .test-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            background: rgba(15, 23, 42, 0.5);
            color: #e2e8f0;
        }
        
        .energy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .energy-source {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .energy-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .logistics-map {
            height: 400px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .agv {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--cyber-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 2s linear;
        }
        
        .quality-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .metric-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .predictive-alert {
            background: rgba(255, 152, 0, 0.1);
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .maintenance-schedule {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .schedule-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        .schedule-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <header class="header">
            <h1>Tech Mahindra Smart Factory</h1>
            <div class="time-display" id="currentTime">Loading...</div>
        </header>
        
        <nav class="sidebar">
            <div class="logo">
                <h2>Tech Mahindra</h2>
            </div>
            
            <div class="nav-container">
                <div class="nav-section">
                    <h3>Dashboard</h3>
                    <div class="nav-item active" data-target="overview">
                        <i>üìä</i> Factory Overview
                    </div>
                    <div class="nav-item" data-target="production">
                        <i>üè≠</i> Production Line
                    </div>
                    <div class="nav-item" data-target="quality">
                        <i>üîç</i> Quality Control
                    </div>
                </div>
                
                <div class="nav-section">
                    <h3>Simulation</h3>
                    <div class="nav-item" data-target="predictive">
                        <i>üîÆ</i> Predictive Analytics
                    </div>
                    <div class="nav-item" data-target="maintenance">
                        <i>üõ†Ô∏è</i> Predictive Maintenance
                    </div>
                    <div class="nav-item" data-target="scenarios">
                        <i>üéØ</i> Scenario Testing
                    </div>
                </div>
                
                <div class="nav-section">
                    <h3>Monitoring</h3>
                    <div class="nav-item" data-target="energy">
                        <i>‚ö°</i> Energy Management
                    </div>
                    <div class="nav-item" data-target="logistics">
                        <i>üöö</i> Internal Logistics
                    </div>
                </div>
                <div class="nav-section" style="margin-top: auto;">
                    <a href="index.html" class="nav-item" style="text-decoration: none; color: #e2e8f0; border-left-color: var(--cyber-purple);">
                        <i>‚Ü©Ô∏è</i> Back to Landing Page
                    </a>
                </div>
            </div>
        </nav>
        
        <main class="main-content">
            <section id="overview" class="content-section active">
                <!-- Overview content remains the same as before -->
                <h2 class="section-title">Factory Overview</h2>
                
                <div class="simulation-controls">
                    <h3>Digital Twin Controls</h3>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="startSimulation">
                            <i>‚ñ∂Ô∏è</i> Start Simulation
                        </button>
                        <button class="btn btn-warning" id="pauseSimulation">
                            <i>‚è∏Ô∏è</i> Pause Simulation
                        </button>
                        <button class="btn btn-danger" id="resetSimulation">
                            <i>üîÑ</i> Reset Simulation
                        </button>
                        <button class="btn btn-success" id="generateData">
                            <i>üìÅ</i> Generate New Data
                        </button>
                    </div>
                    <div class="simulation-status">
                        <div class="status-dot status-stopped" id="statusDot"></div>
                        <span id="simulationStatus">Simulation: Stopped</span>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>üìà</i> Overall Equipment Effectiveness</h3>
                        <div class="kpi-value kpi-good" id="oeeValue">0%</div>
                        <div class="kpi-trend">
                            <span class="trend-up">‚Üë 2.3% from last week</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="oeeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>‚öôÔ∏è</i> Production Rate</h3>
                        <div class="kpi-value kpi-info" id="productionRate">0 units/hr</div>
                        <div class="kpi-trend">
                            <span class="trend-up">‚Üë 5.7% from target</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="productionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>üîß</i> Machine Availability</h3>
                        <div class="kpi-value kpi-warning" id="availabilityValue">0%</div>
                        <div class="kpi-trend">
                            <span class="trend-down">‚Üì 1.2% from yesterday</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="availabilityChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>‚úÖ</i> Quality Rate</h3>
                        <div class="kpi-value kpi-good" id="qualityValue">0%</div>
                        <div class="kpi-trend">
                            <span class="trend-up">‚Üë 0.8% from last month</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="qualityChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="visualization-container">
                    <div class="twin-container">
                        <h3>3D Factory Digital Twin</h3>
                        <div id="factoryTwin"></div>
                    </div>
                    
                    <div class="controls-panel">
                        <h3>Real-time Controls</h3>
                        
                        <div class="control-group">
                            <h4><i>‚ö°</i> Production Speed</h4>
                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Slow</span>
                                    <span id="speedValue">50%</span>
                                    <span>Fast</span>
                                </div>
                                <input type="range" min="0" max="100" value="50" class="slider" id="productionSpeed">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <h4><i>üå°Ô∏è</i> Temperature Control</h4>
                            <div class="slider-container">
                                <div class="slider-label">
                                    <span>Cool</span>
                                    <span id="tempValue">22¬∞C</span>
                                    <span>Warm</span>
                                </div>
                                <input type="range" min="18" max="30" value="22" class="slider" id="temperatureControl">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <h4><i>üîß</i> Machine Settings</h4>
                            <div class="btn-group">
                                <button class="btn btn-primary" id="optimizeSettings">
                                    <i>‚ú®</i> Optimize All
                                </button>
                                <button class="btn btn-warning" id="resetSettings">
                                    <i>‚Ü©Ô∏è</i> Reset to Default
                                </button>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <h4><i>‚ö†Ô∏è</i> Alerts & Notifications</h4>
                            <div id="alertsContainer">
                                <div class="alert alert-warning">
                                    <span class="status-indicator status-warning"></span>
                                    Machine #4 showing elevated vibration levels
                                </div>
                                <div class="alert alert-critical">
                                    <span class="status-indicator status-critical"></span>
                                    Conveyor belt B-2 requires maintenance
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìã</i> Production Line Status</h3>
                    <div id="machineStatusContainer">
                        <!-- Machine status will be dynamically generated -->
                    </div>
                </div>
            </section>
            
            <section id="production" class="content-section">
                <h2 class="section-title">Production Line Monitoring</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>üìä</i> Production Output</h3>
                        <div class="kpi-value kpi-info" id="totalOutput">0</div>
                        <div class="kpi-trend">
                            <span class="trend-up">Today's Production</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="outputChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>‚è±Ô∏è</i> Cycle Time Analysis</h3>
                        <div class="kpi-value kpi-warning" id="avgCycleTime">0s</div>
                        <div class="kpi-trend">
                            <span class="trend-down">Target: 45s</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="cycleTimeChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üè≠</i> Production Line Status</h3>
                    <table class="data-table" id="productionTable">
                        <thead>
                            <tr>
                                <th>Line ID</th>
                                <th>Product</th>
                                <th>Status</th>
                                <th>Speed</th>
                                <th>Output</th>
                                <th>Efficiency</th>
                                <th>Issues</th>
                            </tr>
                        </thead>
                        <tbody id="productionTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div class="card">
                    <h3><i>üìà</i> Real-time Production Metrics</h3>
                    <div class="chart-container">
                        <canvas id="productionMetricsChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section id="quality" class="content-section">
                <h2 class="section-title">Quality Control Center</h2>
                
                <div class="quality-metrics">
                    <div class="metric-card">
                        <div class="energy-icon">‚úÖ</div>
                        <h4>First Pass Yield</h4>
                        <div class="metric-value kpi-good" id="firstPassYield">0%</div>
                        <div>Products passing initial inspection</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="energy-icon">üîç</div>
                        <h4>Defect Rate</h4>
                        <div class="metric-value kpi-bad" id="defectRate">0%</div>
                        <div>Products requiring rework</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="energy-icon">üìä</div>
                        <h4>Quality Score</h4>
                        <div class="metric-value kpi-info" id="qualityScore">0</div>
                        <div>Overall quality rating</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="energy-icon">‚è±Ô∏è</div>
                        <h4>Inspection Time</h4>
                        <div class="metric-value kpi-warning" id="inspectionTime">0s</div>
                        <div>Average per product</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìã</i> Quality Inspection Results</h3>
                    <table class="data-table" id="qualityTable">
                        <thead>
                            <tr>
                                <th>Batch ID</th>
                                <th>Product</th>
                                <th>Inspected</th>
                                <th>Passed</th>
                                <th>Defects</th>
                                <th>Defect Rate</th>
                                <th>Inspector</th>
                            </tr>
                        </thead>
                        <tbody id="qualityTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>üìä</i> Defect Analysis</h3>
                        <div class="chart-container">
                            <canvas id="defectAnalysisChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>üìà</i> Quality Trends</h3>
                        <div class="chart-container">
                            <canvas id="qualityTrendsChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="predictive" class="content-section">
                <h2 class="section-title">Predictive Analytics</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>üîÆ</i> Production Forecast</h3>
                        <div class="kpi-value kpi-info" id="productionForecast">0</div>
                        <div class="kpi-trend">
                            <span>Next 7 days forecast</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="forecastChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>üìà</i> Demand Prediction</h3>
                        <div class="kpi-value kpi-warning" id="demandPrediction">0</div>
                        <div class="kpi-trend">
                            <span>Expected orders next month</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="demandChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>‚ö†Ô∏è</i> Anomaly Detection</h3>
                    <div id="anomalyContainer">
                        <div class="predictive-alert">
                            <span class="status-indicator status-warning"></span>
                            Unusual vibration pattern detected on Machine #3 - 87% probability of bearing wear
                        </div>
                        <div class="predictive-alert">
                            <span class="status-indicator status-critical"></span>
                            Temperature deviation in Heating Zone 2 - 92% probability of sensor fault
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="anomalyChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìä</i> Predictive Model Performance</h3>
                    <div class="chart-container">
                        <canvas id="modelPerformanceChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section id="maintenance" class="content-section">
                <h2 class="section-title">Predictive Maintenance</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>‚è≥</i> Mean Time Between Failures</h3>
                        <div class="kpi-value kpi-info" id="mtbfValue">0h</div>
                        <div class="kpi-trend">
                            <span>Average across all machines</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="mtbfChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>üîß</i> Maintenance Cost</h3>
                        <div class="kpi-value kpi-warning" id="maintenanceCost">$0</div>
                        <div class="kpi-trend">
                            <span>Monthly average</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="maintenanceCostChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="maintenance-schedule">
                    <h3><i>üìÖ</i> Maintenance Schedule</h3>
                    <div id="maintenanceSchedule">
                        <div class="schedule-item">
                            <div>
                                <strong>Machine #4 - CNC Mill</strong>
                                <div>Bearing replacement</div>
                            </div>
                            <div>
                                <div>Due: 2 days</div>
                                <div class="kpi-trend trend-down">High priority</div>
                            </div>
                        </div>
                        <div class="schedule-item">
                            <div>
                                <strong>Assembly Line 2</strong>
                                <div>Routine calibration</div>
                            </div>
                            <div>
                                <div>Due: 7 days</div>
                                <div class="kpi-trend trend-up">Medium priority</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìà</i> Equipment Health Monitoring</h3>
                    <div class="chart-container">
                        <canvas id="equipmentHealthChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section id="scenarios" class="content-section">
                <h2 class="section-title">Scenario Testing</h2>
                
                <div class="scenario-card">
                    <div class="scenario-header">
                        <div class="scenario-title">Machine Failure Simulation</div>
                        <button class="btn btn-warning" id="runFailureTest">Run Test</button>
                    </div>
                    <p>Simulate failure of critical machinery and measure impact on production</p>
                    
                    <div class="test-controls">
                        <div class="input-group">
                            <label for="failureMachine">Select Machine</label>
                            <select id="failureMachine">
                                <option value="M-001">Injection Molder A</option>
                                <option value="M-003">CNC Mill Alpha</option>
                                <option value="M-005">Assembly Robot 1</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="failureDuration">Failure Duration (hours)</label>
                            <input type="number" id="failureDuration" value="4" min="1" max="24">
                        </div>
                    </div>
                    
                    <div class="test-results" id="failureResults">
                        <div class="result-item">
                            <span>Production Loss:</span>
                            <span>0 units</span>
                        </div>
                        <div class="result-item">
                            <span>Cost Impact:</span>
                            <span>$0</span>
                        </div>
                        <div class="result-item">
                            <span>Recovery Time:</span>
                            <span>0 hours</span>
                        </div>
                    </div>
                </div>
                
                <div class="scenario-card">
                    <div class="scenario-header">
                        <div class="scenario-title">Demand Spike Simulation</div>
                        <button class="btn btn-primary" id="runDemandTest">Run Test</button>
                    </div>
                    <p>Simulate 50% increase in product demand and measure system response</p>
                    
                    <div class="test-controls">
                        <div class="input-group">
                            <label for="demandProduct">Select Product</label>
                            <select id="demandProduct">
                                <option value="P-001">Smartphone Case</option>
                                <option value="P-002">Laptop Chassis</option>
                                <option value="P-003">IoT Sensor Housing</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="demandIncrease">Demand Increase (%)</label>
                            <input type="number" id="demandIncrease" value="50" min="10" max="200">
                        </div>
                    </div>
                    
                    <div class="test-results" id="demandResults">
                        <div class="result-item">
                            <span>Additional Capacity Needed:</span>
                            <span>0%</span>
                        </div>
                        <div class="result-item">
                            <span>Lead Time Increase:</span>
                            <span>0 days</span>
                        </div>
                        <div class="result-item">
                            <span>OEE Impact:</span>
                            <span>0%</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìä</i> Scenario Comparison</h3>
                    <div class="chart-container">
                        <canvas id="scenarioComparisonChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section id="energy" class="content-section">
                <h2 class="section-title">Energy Management</h2>
                
                <div class="energy-grid">
                    <div class="energy-source">
                        <div class="energy-icon">‚ö°</div>
                        <h4>Grid Power</h4>
                        <div class="metric-value kpi-info" id="gridPower">0 kWh</div>
                        <div>Current consumption</div>
                    </div>
                    
                    <div class="energy-source">
                        <div class="energy-icon">‚òÄÔ∏è</div>
                        <h4>Solar Generation</h4>
                        <div class="metric-value kpi-good" id="solarPower">0 kWh</div>
                        <div>Today's production</div>
                    </div>
                    
                    <div class="energy-source">
                        <div class="energy-icon">üîã</div>
                        <h4>Battery Storage</h4>
                        <div class="metric-value kpi-warning" id="batteryLevel">0%</div>
                        <div>Current charge level</div>
                    </div>
                    
                    <div class="energy-source">
                        <div class="energy-icon">üí°</div>
                        <h4>Energy Efficiency</h4>
                        <div class="metric-value kpi-good" id="energyEfficiency">0%</div>
                        <div>Overall rating</div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>üìà</i> Energy Consumption</h3>
                        <div class="chart-container">
                            <canvas id="energyConsumptionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>üí∏</i> Energy Cost Analysis</h3>
                        <div class="chart-container">
                            <canvas id="energyCostChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìã</i> Equipment Energy Usage</h3>
                    <table class="data-table" id="energyTable">
                        <thead>
                            <tr>
                                <th>Equipment</th>
                                <th>Power (kW)</th>
                                <th>Daily Usage</th>
                                <th>Cost/Day</th>
                                <th>Efficiency</th>
                            </tr>
                        </thead>
                        <tbody id="energyTableBody">
                        </tbody>
                    </table>
                </div>
            </section>
            
            <section id="logistics" class="content-section">
                <h2 class="section-title">Internal Logistics</h2>
                
                <div class="logistics-map" id="logisticsMap">
                    <!-- AGVs will be positioned here dynamically -->
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3><i>üöö</i> AGV Fleet Status</h3>
                        <div class="kpi-value kpi-info" id="agvCount">0</div>
                        <div class="kpi-trend">
                            <span>Active vehicles</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="agvStatusChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3><i>üì¶</i> Material Flow</h3>
                        <div class="kpi-value kpi-warning" id="materialFlow">0/hr</div>
                        <div class="kpi-trend">
                            <span>Units moved per hour</span>
                        </div>
                        <div class="chart-container">
                            <canvas id="materialFlowChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3><i>üìã</i> Inventory Status</h3>
                    <table class="data-table" id="inventoryTable">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Current Stock</th>
                                <th>Location</th>
                                <th>Replenishment</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Comprehensive Digital Twin Data Management
        class CompleteDigitalTwinData {
            constructor() {
                this.data = this.loadData() || this.generateCompleteInitialData();
                this.simulationInterval = null;
                this.isSimulating = false;
                this.simulationSpeed = 1.0;
                this.scenarioResults = {};
            }

            generateCompleteInitialData() {
                // Enhanced machine data with more attributes
                const machines = [
                    { id: 'M-001', name: 'Injection Molder A', type: 'Molding', baseEfficiency: 0.87, powerRating: 45 },
                    { id: 'M-002', name: 'Injection Molder B', type: 'Molding', baseEfficiency: 0.85, powerRating: 45 },
                    { id: 'M-003', name: 'CNC Mill Alpha', type: 'Machining', baseEfficiency: 0.92, powerRating: 30 },
                    { id: 'M-004', name: 'CNC Mill Beta', type: 'Machining', baseEfficiency: 0.89, powerRating: 30 },
                    { id: 'M-005', name: 'Assembly Robot 1', type: 'Assembly', baseEfficiency: 0.94, powerRating: 15 },
                    { id: 'M-006', name: 'Assembly Robot 2', type: 'Assembly', baseEfficiency: 0.91, powerRating: 15 },
                    { id: 'M-007', name: 'Painting Station', type: 'Finishing', baseEfficiency: 0.88, powerRating: 25 },
                    { id: 'M-008', name: 'Quality Control', type: 'Inspection', baseEfficiency: 0.96, powerRating: 10 }
                ];

                const products = [
                    { id: 'P-001', name: 'Smartphone Case', materials: ['Polycarbonate', 'TPU'], cycleTime: 45, demand: 1000 },
                    { id: 'P-002', name: 'Laptop Chassis', materials: ['Aluminum', 'Plastic'], cycleTime: 120, demand: 500 },
                    { id: 'P-003', name: 'IoT Sensor Housing', materials: ['ABS', 'Metal'], cycleTime: 30, demand: 2000 }
                ];

                // Generate quality control data
                const qualityData = this.generateQualityData(30);
                
                // Generate predictive maintenance data
                const maintenanceData = this.generateMaintenanceData();
                
                // Generate energy management data
                const energyData = this.generateEnergyData(30);
                
                // Generate logistics data
                const logisticsData = this.generateLogisticsData();

                const baseData = {
                    machines: machines.map(machine => ({
                        ...machine,
                        status: 'running',
                        currentProduct: products[Math.floor(Math.random() * products.length)].id,
                        efficiency: machine.baseEfficiency,
                        output: 0,
                        temperature: 22 + Math.random() * 5,
                        vibration: 0.1 + Math.random() * 0.3,
                        lastMaintenance: new Date(Date.now() - Math.random() * 10 * 24 * 60 * 60 * 1000).toISOString(),
                        health: 0.85 + Math.random() * 0.1,
                        issues: [],
                        energyUsage: 0,
                        qualityMetrics: {
                            firstPassYield: 90 + Math.random() * 8,
                            defectRate: 1 + Math.random() * 3
                        }
                    })),
                    products,
                    metrics: this.generateMetricsHistory(30),
                    quality: qualityData,
                    maintenance: maintenanceData,
                    energy: energyData,
                    logistics: logisticsData,
                    alerts: [],
                    settings: {
                        productionSpeed: 0.5,
                        temperature: 22,
                        energyMode: 'balanced'
                    },
                    simulationTime: new Date().toISOString(),
                    scenarioResults: {}
                };

                this.saveData(baseData);
                return baseData;
            }

            generateQualityData(days) {
                const inspections = [];
                const defectTypes = ['Dimensional', 'Surface', 'Material', 'Assembly', 'Cosmetic'];
                
                for (let i = 0; i < 50; i++) {
                    const timestamp = new Date(Date.now() - Math.random() * days * 24 * 60 * 60 * 1000);
                    const inspected = Math.floor(Math.random() * 100) + 50;
                    const defects = Math.floor(Math.random() * 10);
                    
                    inspections.push({
                        id: `QI-${String(i+1).padStart(4, '0')}`,
                        timestamp: timestamp.toISOString(),
                        product: `P-00${Math.floor(Math.random() * 3) + 1}`,
                        inspected: inspected,
                        passed: inspected - defects,
                        defects: defects,
                        defectRate: (defects / inspected) * 100,
                        defectType: defectTypes[Math.floor(Math.random() * defectTypes.length)],
                        inspector: `Inspector-${Math.floor(Math.random() * 5) + 1}`
                    });
                }
                
                return {
                    inspections,
                    overallFirstPassYield: 95.2,
                    overallDefectRate: 2.1,
                    trends: this.generateQualityTrends(days)
                };
            }

            generateMaintenanceData() {
                const schedules = [];
                const now = new Date();
                
                for (let i = 0; i < 8; i++) {
                    const dueDate = new Date(now);
                    dueDate.setDate(dueDate.getDate() + Math.floor(Math.random() * 30) + 1);
                    
                    schedules.push({
                        machineId: `M-00${i+1}`,
                        task: ['Bearing replacement', 'Calibration', 'Software update', 'Component inspection'][Math.floor(Math.random() * 4)],
                        dueDate: dueDate.toISOString(),
                        priority: ['High', 'Medium', 'Low'][Math.floor(Math.random() * 3)],
                        estimatedDuration: Math.floor(Math.random() * 8) + 2,
                        costEstimate: Math.floor(Math.random() * 5000) + 1000
                    });
                }
                
                return {
                    schedules,
                    mtbf: 450, // Mean Time Between Failures in hours
                    mttr: 4.5, // Mean Time To Repair in hours
                    costPerMonth: 12500
                };
            }

            generateEnergyData(days) {
                const consumption = [];
                const baseDate = new Date();
                
                for (let i = days; i >= 0; i--) {
                    const date = new Date(baseDate);
                    date.setDate(date.getDate() - i);
                    
                    consumption.push({
                        timestamp: date.toISOString(),
                        gridPower: 800 + Math.random() * 400,
                        solarPower: 200 + Math.random() * 150,
                        batteryLevel: 30 + Math.random() * 70,
                        efficiency: 75 + Math.random() * 20,
                        cost: (800 + Math.random() * 400) * 0.12 // Assuming $0.12 per kWh
                    });
                }
                
                return {
                    consumption,
                    current: {
                        gridPower: 950,
                        solarPower: 280,
                        batteryLevel: 65,
                        efficiency: 82
                    }
                };
            }

            generateLogisticsData() {
                const agvs = [];
                const inventory = [];
                
                // Generate AGV data
                for (let i = 0; i < 5; i++) {
                    agvs.push({
                        id: `AGV-${i+1}`,
                        status: ['Active', 'Charging', 'Maintenance'][Math.floor(Math.random() * 3)],
                        battery: 20 + Math.random() * 80,
                        location: `Zone-${Math.floor(Math.random() * 5) + 1}`,
                        currentTask: `Transporting materials to Line-${Math.floor(Math.random() * 3) + 1}`,
                        speed: 1 + Math.random() * 2
                    });
                }
                
                // Generate inventory data
                const materials = ['Steel Coils', 'Electronic Components', 'Plastic Pellets', 'Packaging', 'Fasteners'];
                for (let i = 0; i < materials.length; i++) {
                    inventory.push({
                        material: materials[i],
                        currentStock: Math.floor(Math.random() * 10000) + 1000,
                        location: `WH-${Math.floor(Math.random() * 3) + 1}`,
                        replenishment: ['Automatic', 'Manual', 'Scheduled'][Math.floor(Math.random() * 3)],
                        status: ['Adequate', 'Low', 'Critical'][Math.floor(Math.random() * 3)]
                    });
                }
                
                return {
                    agvs,
                    inventory,
                    materialFlow: 150 + Math.random() * 50
                };
            }

            generateQualityTrends(days) {
                const trends = [];
                const baseDate = new Date();
                
                for (let i = days; i >= 0; i--) {
                    const date = new Date(baseDate);
                    date.setDate(date.getDate() - i);
                    
                    trends.push({
                        timestamp: date.toISOString(),
                        firstPassYield: 90 + Math.random() * 8,
                        defectRate: 1 + Math.random() * 4
                    });
                }
                
                return trends;
            }

            generateMetricsHistory(days) {
                const history = [];
                const baseDate = new Date();
                
                for (let i = days; i >= 0; i--) {
                    const date = new Date(baseDate);
                    date.setDate(date.getDate() - i);
                    
                    history.push({
                        timestamp: date.toISOString(),
                        oee: 75 + Math.random() * 15,
                        productionRate: 80 + Math.random() * 30,
                        availability: 85 + Math.random() * 10,
                        qualityRate: 95 + Math.random() * 4,
                        energyConsumption: 1200 + Math.random() * 300,
                        downtime: Math.random() * 120
                    });
                }
                return history;
            }

            updateData() {
                if (!this.isSimulating) return;

                const now = new Date();
                this.data.simulationTime = now.toISOString();

                // Update all data points with fresh timestamps including milliseconds
                this.updateMachineData(now);
                this.updateQualityData(now);
                this.updateEnergyData(now);
                this.updateLogisticsData(now);
                this.updateMaintenanceData(now);
                this.addNewMetricsPoint(now);

                this.saveData(this.data);
                if (this.onDataUpdate) {
                    this.onDataUpdate(this.data);
                }
            }

            updateMachineData(now) {
                this.data.machines.forEach(machine => {
                    // Simulate small fluctuations with millisecond precision
                    const fluctuation = (Math.random() - 0.5) * 0.02 * this.simulationSpeed;
                    machine.efficiency = Math.max(0.7, Math.min(0.98, machine.efficiency + fluctuation));
                    
                    machine.temperature = 22 + (Math.random() - 0.5) * 2 * this.simulationSpeed;
                    machine.vibration = Math.max(0.1, Math.min(0.8, 
                        machine.vibration + (Math.random() - 0.5) * 0.05 * this.simulationSpeed));
                    
                    // Calculate output based on efficiency and simulation speed
                    const baseOutput = 10 * this.simulationSpeed;
                    machine.output += baseOutput * machine.efficiency;
                    
                    // Health degradation over time
                    machine.health = Math.max(0.3, machine.health - 0.0001 * this.simulationSpeed);
                    
                    // Energy usage
                    machine.energyUsage += machine.powerRating * this.simulationSpeed / 60; // kWh
                    
                    // Generate occasional issues
                    if (Math.random() < 0.02 * this.simulationSpeed) {
                        this.generateMachineIssue(machine, now);
                    }
                });
            }

            generateMachineIssue(machine, timestamp) {
                const issues = [
                    'Slight misalignment detected',
                    'Tool wear warning',
                    'Temperature fluctuation',
                    'Unusual vibration pattern',
                    'Component requires calibration'
                ];
                const newIssue = issues[Math.floor(Math.random() * issues.length)];
                
                if (!machine.issues.includes(newIssue)) {
                    machine.issues.push(newIssue);
                    this.addAlert(`Machine ${machine.id}: ${newIssue}`, 'warning', timestamp);
                }
                
                // Critical issues if health is low
                if (machine.health < 0.5 && Math.random() < 0.05 * this.simulationSpeed) {
                    const criticalIssues = [
                        'Critical failure imminent',
                        'Emergency shutdown required',
                        'Component failure detected'
                    ];
                    const criticalIssue = criticalIssues[Math.floor(Math.random() * criticalIssues.length)];
                    machine.issues = [criticalIssue]; // Replace all issues with critical one
                    this.addAlert(`Machine ${machine.id}: ${criticalIssue}`, 'critical', timestamp);
                }
            }

            updateQualityData(now) {
                // Add new quality inspection
                if (Math.random() < 0.1 * this.simulationSpeed) {
                    const defectTypes = ['Dimensional', 'Surface', 'Material', 'Assembly', 'Cosmetic'];
                    const inspected = Math.floor(Math.random() * 100) + 50;
                    const defects = Math.floor(Math.random() * 10);
                    
                    this.data.quality.inspections.unshift({
                        id: `QI-${String(this.data.quality.inspections.length + 1).padStart(4, '0')}`,
                        timestamp: now.toISOString(),
                        product: `P-00${Math.floor(Math.random() * 3) + 1}`,
                        inspected: inspected,
                        passed: inspected - defects,
                        defects: defects,
                        defectRate: (defects / inspected) * 100,
                        defectType: defectTypes[Math.floor(Math.random() * defectTypes.length)],
                        inspector: `Inspector-${Math.floor(Math.random() * 5) + 1}`
                    });
                    
                    // Keep only last 100 inspections
                    if (this.data.quality.inspections.length > 100) {
                        this.data.quality.inspections = this.data.quality.inspections.slice(0, 100);
                    }
                    
                    // Update overall quality metrics
                    this.updateOverallQualityMetrics();
                }
            }

            updateOverallQualityMetrics() {
                const recentInspections = this.data.quality.inspections.slice(0, 10);
                const totalInspected = recentInspections.reduce((sum, i) => sum + i.inspected, 0);
                const totalDefects = recentInspections.reduce((sum, i) => sum + i.defects, 0);
                
                if (totalInspected > 0) {
                    this.data.quality.overallDefectRate = (totalDefects / totalInspected) * 100;
                    this.data.quality.overallFirstPassYield = 100 - this.data.quality.overallDefectRate;
                }
            }

            updateEnergyData(now) {
                // Update current energy data with small fluctuations
                this.data.energy.current.gridPower = 800 + Math.random() * 400;
                this.data.energy.current.solarPower = 200 + Math.random() * 150;
                this.data.energy.current.batteryLevel = 30 + Math.random() * 70;
                this.data.energy.current.efficiency = 75 + Math.random() * 20;
                
                // Add to consumption history
                this.data.energy.consumption.push({
                    timestamp: now.toISOString(),
                    gridPower: this.data.energy.current.gridPower,
                    solarPower: this.data.energy.current.solarPower,
                    batteryLevel: this.data.energy.current.batteryLevel,
                    efficiency: this.data.energy.current.efficiency,
                    cost: this.data.energy.current.gridPower * 0.12
                });
                
                // Keep only last 200 data points
                if (this.data.energy.consumption.length > 200) {
                    this.data.energy.consumption = this.data.energy.consumption.slice(-200);
                }
            }

            updateLogisticsData(now) {
                // Update AGV status and positions
                this.data.logistics.agvs.forEach(agv => {
                    if (agv.status === 'Active') {
                        agv.battery = Math.max(5, agv.battery - 0.5 * this.simulationSpeed);
                        if (agv.battery <= 10) {
                            agv.status = 'Charging';
                        }
                    } else if (agv.status === 'Charging') {
                        agv.battery = Math.min(100, agv.battery + 5 * this.simulationSpeed);
                        if (agv.battery >= 95) {
                            agv.status = 'Active';
                        }
                    }
                    
                    // Update material flow
                    this.data.logistics.materialFlow = 150 + Math.random() * 50;
                });
                
                // Update inventory levels
                this.data.logistics.inventory.forEach(item => {
                    // Simulate consumption
                    item.currentStock = Math.max(0, item.currentStock - Math.random() * 10 * this.simulationSpeed);
                    
                    // Update status based on stock level
                    if (item.currentStock < 200) {
                        item.status = 'Critical';
                    } else if (item.currentStock < 1000) {
                        item.status = 'Low';
                    } else {
                        item.status = 'Adequate';
                    }
                });
            }

            updateMaintenanceData(now) {
                // Update maintenance schedules (reduce time until due)
                this.data.maintenance.schedules.forEach(schedule => {
                    const dueDate = new Date(schedule.dueDate);
                    // Simulate time passing
                    dueDate.setHours(dueDate.getHours() - 1 * this.simulationSpeed);
                    schedule.dueDate = dueDate.toISOString();
                });
                
                // Update MTBF and cost metrics with small fluctuations
                this.data.maintenance.mtbf += (Math.random() - 0.5) * 2;
                this.data.maintenance.mttr += (Math.random() - 0.5) * 0.1;
                this.data.maintenance.costPerMonth += (Math.random() - 0.5) * 100;
            }

            addNewMetricsPoint(now) {
                const latestMetrics = this.data.metrics[this.data.metrics.length - 1];
                this.data.metrics.push({
                    timestamp: now.toISOString(),
                    oee: Math.max(70, Math.min(95, latestMetrics.oee + (Math.random() - 0.5) * 2)),
                    productionRate: Math.max(50, Math.min(120, latestMetrics.productionRate + (Math.random() - 0.5) * 5)),
                    availability: Math.max(80, Math.min(98, latestMetrics.availability + (Math.random() - 0.5) * 1)),
                    qualityRate: Math.max(92, Math.min(99.5, latestMetrics.qualityRate + (Math.random() - 0.5) * 0.5)),
                    energyConsumption: Math.max(1000, Math.min(1600, latestMetrics.energyConsumption + (Math.random() - 0.5) * 20)),
                    downtime: Math.max(0, latestMetrics.downtime + (Math.random() - 0.5) * 10)
                });

                // Keep only last 200 data points
                if (this.data.metrics.length > 200) {
                    this.data.metrics = this.data.metrics.slice(-200);
                }
            }

            addAlert(message, type, timestamp) {
                const alert = {
                    id: this.generateId(),
                    message,
                    type,
                    timestamp: timestamp.toISOString(),
                    acknowledged: false
                };
                
                this.data.alerts.unshift(alert);
                // Keep only last 10 alerts
                if (this.data.alerts.length > 10) {
                    this.data.alerts = this.data.alerts.slice(0, 10);
                }
            }

            runScenarioTest(scenarioType, parameters) {
                const now = new Date();
                let results = {};
                
                switch(scenarioType) {
                    case 'machineFailure':
                        results = this.simulateMachineFailure(parameters.machineId, parameters.duration);
                        break;
                    case 'demandSpike':
                        results = this.simulateDemandSpike(parameters.productId, parameters.increase);
                        break;
                    case 'energyOutage':
                        results = this.simulateEnergyOutage(parameters.duration);
                        break;
                }
                
                // Store scenario results
                this.data.scenarioResults[scenarioType] = {
                    timestamp: now.toISOString(),
                    parameters,
                    results
                };
                
                return results;
            }

            simulateMachineFailure(machineId, durationHours) {
                const machine = this.data.machines.find(m => m.id === machineId);
                if (!machine) return { error: 'Machine not found' };
                
                const productionLoss = machine.output * (durationHours / 24);
                const costImpact = productionLoss * 50; // Assuming $50 per unit
                const recoveryTime = durationHours * 1.2; // Recovery takes 20% longer
                
                return {
                    productionLoss: Math.round(productionLoss),
                    costImpact: Math.round(costImpact),
                    recoveryTime: recoveryTime.toFixed(1),
                    affectedProducts: [machine.currentProduct]
                };
            }

            simulateDemandSpike(productId, increasePercent) {
                const product = this.data.products.find(p => p.id === productId);
                if (!product) return { error: 'Product not found' };
                
                const currentDemand = product.demand;
                const newDemand = currentDemand * (1 + increasePercent / 100);
                const capacityNeeded = ((newDemand - currentDemand) / currentDemand) * 100;
                const leadTimeIncrease = capacityNeeded > 20 ? 2 : capacityNeeded > 10 ? 1 : 0;
                const oeeImpact = capacityNeeded > 30 ? -5 : capacityNeeded > 15 ? -2 : 0;
                
                return {
                    additionalCapacity: capacityNeeded.toFixed(1),
                    leadTimeIncrease,
                    oeeImpact,
                    newProductionTarget: Math.round(newDemand)
                };
            }

            simulateEnergyOutage(durationHours) {
                const energyCost = this.data.energy.current.gridPower * durationHours * 0.12;
                const productionLoss = this.data.metrics[this.data.metrics.length - 1].productionRate * durationHours;
                const costImpact = productionLoss * 50 + energyCost;
                
                return {
                    energyCost: Math.round(energyCost),
                    productionLoss: Math.round(productionLoss),
                    totalCostImpact: Math.round(costImpact),
                    affectedMachines: this.data.machines.length
                };
            }

            generateId() {
                return Math.random().toString(36).substr(2, 9);
            }

            loadData() {
                const saved = localStorage.getItem('completeDigitalTwinData');
                return saved ? JSON.parse(saved) : null;
            }

            saveData(data) {
                localStorage.setItem('completeDigitalTwinData', JSON.stringify(data));
            }

            clearData() {
                localStorage.removeItem('completeDigitalTwinData');
                this.data = this.generateCompleteInitialData();
            }

            startSimulation(callback) {
                this.isSimulating = true;
                this.onDataUpdate = callback;
                this.simulationInterval = setInterval(() => this.updateData(), 1000 / this.simulationSpeed);
            }

            stopSimulation() {
                this.isSimulating = false;
                if (this.simulationInterval) {
                    clearInterval(this.simulationInterval);
                    this.simulationInterval = null;
                }
            }

            setSimulationSpeed(speed) {
                this.simulationSpeed = speed;
                if (this.isSimulating) {
                    this.stopSimulation();
                    this.startSimulation(this.onDataUpdate);
                }
            }
        }

        // Enhanced Visualization Manager with all sections
        class CompleteVisualizationManager {
            constructor() {
                this.charts = {};
                this.agvPositions = {};
                this.initAGVPositions();
            }

            initAGVPositions() {
                // Initialize random positions for AGVs
                for (let i = 1; i <= 5; i++) {
                    this.agvPositions[`AGV-${i}`] = {
                        x: Math.random() * 80 + 10,
                        y: Math.random() * 80 + 10
                    };
                }
            }

            updateAGVPositions() {
                // Move AGVs randomly
                for (let agvId in this.agvPositions) {
                    this.agvPositions[agvId].x += (Math.random() - 0.5) * 10;
                    this.agvPositions[agvId].y += (Math.random() - 0.5) * 10;
                    
                    // Keep within bounds
                    this.agvPositions[agvId].x = Math.max(5, Math.min(95, this.agvPositions[agvId].x));
                    this.agvPositions[agvId].y = Math.max(5, Math.min(95, this.agvPositions[agvId].y));
                }
            }

            renderLogisticsMap(agvs) {
                const map = document.getElementById('logisticsMap');
                map.innerHTML = '';
                
                agvs.forEach(agv => {
                    const agvElement = document.createElement('div');
                    agvElement.className = 'agv';
                    agvElement.id = agv.id;
                    agvElement.textContent = agv.id.split('-')[1];
                    agvElement.style.left = `${this.agvPositions[agv.id].x}%`;
                    agvElement.style.top = `${this.agvPositions[agv.id].y}%`;
                    
                    // Color code by status
                    if (agv.status === 'Active') {
                        agvElement.style.background = 'var(--success)';
                    } else if (agv.status === 'Charging') {
                        agvElement.style.background = 'var(--warning)';
                    } else {
                        agvElement.style.background = 'var(--danger)';
                    }
                    
                    map.appendChild(agvElement);
                });
            }

            // Production Line Charts
            createOutputChart(data) {
                const ctx = document.getElementById('outputChart').getContext('2d');
                const labels = data.metrics.slice(-20).map(m => new Date(m.timestamp).toLocaleTimeString());
                const outputData = data.metrics.slice(-20).map(m => m.productionRate);

                if (this.charts.output) {
                    this.charts.output.destroy();
                }

                this.charts.output = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Production Output (units/hr)',
                            data: outputData,
                            backgroundColor: 'rgba(33, 150, 243, 0.7)',
                            borderColor: 'rgba(33, 150, 243, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: this.getChartOptions()
                });
            }

            createCycleTimeChart(data) {
                const ctx = document.getElementById('cycleTimeChart').getContext('2d');
                const labels = data.metrics.slice(-20).map(m => new Date(m.timestamp).toLocaleTimeString());
                const cycleTimes = data.metrics.slice(-20).map(m => 60 - (m.oee - 70) / 25 * 15); // Simulated cycle times

                if (this.charts.cycleTime) {
                    this.charts.cycleTime.destroy();
                }

                this.charts.cycleTime = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Cycle Time (seconds)',
                            data: cycleTimes,
                            borderColor: 'rgba(255, 152, 0, 1)',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: this.getChartOptions()
                });
            }

            // Quality Control Charts
            createDefectAnalysisChart(qualityData) {
                const ctx = document.getElementById('defectAnalysisChart').getContext('2d');
                const defectTypes = {};
                
                qualityData.inspections.forEach(inspection => {
                    defectTypes[inspection.defectType] = (defectTypes[inspection.defectType] || 0) + inspection.defects;
                });

                if (this.charts.defectAnalysis) {
                    this.charts.defectAnalysis.destroy();
                }

                this.charts.defectAnalysis = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(defectTypes),
                        datasets: [{
                            data: Object.values(defectTypes),
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.7)',
                                'rgba(54, 162, 235, 0.7)',
                                'rgba(255, 206, 86, 0.7)',
                                'rgba(75, 192, 192, 0.7)',
                                'rgba(153, 102, 255, 0.7)'
                            ]
                        }]
                    },
                    options: this.getChartOptions()
                });
            }

            createQualityTrendsChart(qualityData) {
                const ctx = document.getElementById('qualityTrendsChart').getContext('2d');
                const trends = qualityData.trends.slice(-30);
                const labels = trends.map(t => new Date(t.timestamp).toLocaleDateString());
                const firstPassYield = trends.map(t => t.firstPassYield);
                const defectRates = trends.map(t => t.defectRate);

                if (this.charts.qualityTrends) {
                    this.charts.qualityTrends.destroy();
                }

                this.charts.qualityTrends = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'First Pass Yield %',
                                data: firstPassYield,
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'Defect Rate %',
                                data: defectRates,
                                borderColor: 'rgba(244, 67, 54, 1)',
                                backgroundColor: 'rgba(244, 67, 54, 0.1)',
                                yAxisID: 'y1',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        ...this.getChartOptions(),
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                min: 85,
                                max: 100
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                min: 0,
                                max: 8,
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        }
                    }
                });
            }

            // Predictive Analytics Charts
            createForecastChart() {
                const ctx = document.getElementById('forecastChart').getContext('2d');
                const days = ['Today', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
                const historical = [85, 87, 84, 86, 88, 85, 87];
                const forecast = [87, 89, 86, 88, 90, 87, 89];

                if (this.charts.forecast) {
                    this.charts.forecast.destroy();
                }

                this.charts.forecast = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: days,
                        datasets: [
                            {
                                label: 'Historical',
                                data: historical,
                                borderColor: 'rgba(100, 116, 139, 1)',
                                borderDash: [5, 5],
                                tension: 0.4
                            },
                            {
                                label: 'Forecast',
                                data: forecast,
                                borderColor: 'rgba(33, 150, 243, 1)',
                                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: this.getChartOptions()
                });
            }

            createAnomalyChart() {
                const ctx = document.getElementById('anomalyChart').getContext('2d');
                const timestamps = Array.from({length: 50}, (_, i) => `T-${50-i}`);
                const values = Array.from({length: 50}, () => 50 + Math.random() * 30);
                // Add some anomalies
                values[15] = 120;
                values[32] = 20;
                values[45] = 130;

                if (this.charts.anomaly) {
                    this.charts.anomaly.destroy();
                }

                this.charts.anomaly = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timestamps,
                        datasets: [{
                            label: 'Sensor Reading',
                            data: values,
                            borderColor: 'rgba(33, 150, 243, 1)',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: values.map((v, i) => 
                                [15, 32, 45].includes(i) ? 'rgba(244, 67, 54, 1)' : 'rgba(33, 150, 243, 1)'
                            ),
                            pointBorderColor: values.map((v, i) => 
                                [15, 32, 45].includes(i) ? 'rgba(244, 67, 54, 1)' : 'rgba(33, 150, 243, 1)'
                            )
                        }]
                    },
                    options: this.getChartOptions()
                });
            }

            // Energy Management Charts
            createEnergyConsumptionChart(energyData) {
                const ctx = document.getElementById('energyConsumptionChart').getContext('2d');
                const consumption = energyData.consumption.slice(-30);
                const labels = consumption.map(c => new Date(c.timestamp).toLocaleDateString());
                const gridPower = consumption.map(c => c.gridPower);
                const solarPower = consumption.map(c => c.solarPower);

                if (this.charts.energyConsumption) {
                    this.charts.energyConsumption.destroy();
                }

                this.charts.energyConsumption = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Grid Power (kWh)',
                                data: gridPower,
                                borderColor: 'rgba(255, 152, 0, 1)',
                                backgroundColor: 'rgba(255, 152, 0, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Solar Power (kWh)',
                                data: solarPower,
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: this.getChartOptions()
                });
            }

            // Maintenance Charts
            createEquipmentHealthChart(machines) {
                const ctx = document.getElementById('equipmentHealthChart').getContext('2d');
                const machineNames = machines.map(m => m.name);
                const healthLevels = machines.map(m => m.health * 100);

                if (this.charts.equipmentHealth) {
                    this.charts.equipmentHealth.destroy();
                }

                this.charts.equipmentHealth = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: machineNames,
                        datasets: [{
                            label: 'Health %',
                            data: healthLevels,
                            backgroundColor: healthLevels.map(h => 
                                h > 80 ? 'rgba(76, 175, 80, 0.7)' : 
                                h > 60 ? 'rgba(255, 152, 0, 0.7)' : 'rgba(244, 67, 54, 0.7)'
                            ),
                            borderColor: healthLevels.map(h => 
                                h > 80 ? 'rgba(76, 175, 80, 1)' : 
                                h > 60 ? 'rgba(255, 152, 0, 1)' : 'rgba(244, 67, 54, 1)'
                            ),
                            borderWidth: 1
                        }]
                    },
                    options: this.getChartOptions()
                });
            }

            // Scenario Testing Chart
            createScenarioComparisonChart(scenarioResults) {
                const ctx = document.getElementById('scenarioComparisonChart').getContext('2d');
                const scenarios = Object.keys(scenarioResults);
                const costImpacts = scenarios.map(s => scenarioResults[s].results.costImpact || 0);

                if (this.charts.scenarioComparison) {
                    this.charts.scenarioComparison.destroy();
                }

                this.charts.scenarioComparison = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: scenarios.map(s => s.replace(/([A-Z])/g, ' $1').trim()),
                        datasets: [{
                            label: 'Cost Impact ($)',
                            data: costImpacts,
                            backgroundColor: 'rgba(156, 78, 221, 0.7)',
                            borderColor: 'rgba(156, 78, 221, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: this.getChartOptions()
                });
            }

            getChartOptions() {
                return {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(100, 116, 139, 0.2)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(100, 116, 139, 0.2)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        }
                    }
                };
            }

            // Update all charts
            updateAllCharts(data) {
                this.createOutputChart(data);
                this.createCycleTimeChart(data);
                this.createDefectAnalysisChart(data.quality);
                this.createQualityTrendsChart(data.quality);
                this.createForecastChart();
                this.createAnomalyChart();
                this.createEnergyConsumptionChart(data.energy);
                this.createEquipmentHealthChart(data.machines);
                
                if (Object.keys(data.scenarioResults).length > 0) {
                    this.createScenarioComparisonChart(data.scenarioResults);
                }
            }
        }

        // Complete UI Manager for all sections
        class CompleteDigitalTwinUI {
            constructor() {
                this.dataManager = new CompleteDigitalTwinData();
                this.vizManager = new CompleteVisualizationManager();
                this.init();
            }

            init() {
                this.setupNavigation();
                this.setupControls();
                this.updateTime();
                this.renderAll();
                
                setInterval(() => this.updateTime(), 1000);
            }

            setupNavigation() {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                        document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                        
                        item.classList.add('active');
                        const targetId = item.getAttribute('data-target');
                        document.getElementById(targetId).classList.add('active');
                        
                        // Render the specific section
                        this.renderSection(targetId);
                    });
                });
            }

            setupControls() {
                // Simulation controls
                document.getElementById('startSimulation').addEventListener('click', () => {
                    this.dataManager.startSimulation((data) => this.renderAll());
                    document.getElementById('simulationStatus').textContent = 'Simulation: Running';
                    document.getElementById('statusDot').className = 'status-dot status-running';
                });

                document.getElementById('pauseSimulation').addEventListener('click', () => {
                    this.dataManager.stopSimulation();
                    document.getElementById('simulationStatus').textContent = 'Simulation: Paused';
                    document.getElementById('statusDot').className = 'status-dot status-stopped';
                });

                document.getElementById('resetSimulation').addEventListener('click', () => {
                    this.dataManager.stopSimulation();
                    this.dataManager.clearData();
                    this.renderAll();
                    document.getElementById('simulationStatus').textContent = 'Simulation: Stopped';
                    document.getElementById('statusDot').className = 'status-dot status-stopped';
                });

                document.getElementById('generateData').addEventListener('click', () => {
                    this.dataManager.clearData();
                    this.renderAll();
                });

                // Production speed slider
                document.getElementById('productionSpeed').addEventListener('input', (e) => {
                    const value = e.target.value;
                    document.getElementById('speedValue').textContent = `${value}%`;
                    this.dataManager.setSimulationSpeed(value / 50);
                });

                // Scenario testing controls
                document.getElementById('runFailureTest').addEventListener('click', () => {
                    const machineId = document.getElementById('failureMachine').value;
                    const duration = parseInt(document.getElementById('failureDuration').value);
                    
                    const results = this.dataManager.runScenarioTest('machineFailure', {
                        machineId, duration
                    });
                    
                    this.displayScenarioResults('failureResults', results);
                });

                document.getElementById('runDemandTest').addEventListener('click', () => {
                    const productId = document.getElementById('demandProduct').value;
                    const increase = parseInt(document.getElementById('demandIncrease').value);
                    
                    const results = this.dataManager.runScenarioTest('demandSpike', {
                        productId, increase
                    });
                    
                    this.displayScenarioResults('demandResults', results);
                });
            }

            displayScenarioResults(containerId, results) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                
                for (const [key, value] of Object.entries(results)) {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    
                    const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    div.innerHTML = `<span>${label}:</span><span>${value}</span>`;
                    
                    container.appendChild(div);
                }
            }

            updateTime() {
                const now = new Date();
                document.getElementById('currentTime').textContent = 
                    now.toLocaleString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit',
                        fractionalSecondDigits: 3
                    });
            }

            renderAll() {
                const data = this.dataManager.data;
                
                // Update overview KPIs
                this.renderOverview(data);
                
                // Update all visualizations
                this.vizManager.updateAllCharts(data);
                
                // Update logistics map
                this.vizManager.updateAGVPositions();
                this.vizManager.renderLogisticsMap(data.logistics.agvs);
                
                // Render current section
                const activeSection = document.querySelector('.content-section.active').id;
                this.renderSection(activeSection);
            }

            renderSection(sectionId) {
                const data = this.dataManager.data;
                
                switch(sectionId) {
                    case 'production':
                        this.renderProductionSection(data);
                        break;
                    case 'quality':
                        this.renderQualitySection(data);
                        break;
                    case 'predictive':
                        this.renderPredictiveSection(data);
                        break;
                    case 'maintenance':
                        this.renderMaintenanceSection(data);
                        break;
                    case 'energy':
                        this.renderEnergySection(data);
                        break;
                    case 'logistics':
                        this.renderLogisticsSection(data);
                        break;
                    default:
                        this.renderOverview(data);
                }
            }

            renderOverview(data) {
                const latestMetrics = data.metrics[data.metrics.length - 1];
                document.getElementById('oeeValue').textContent = latestMetrics.oee.toFixed(1) + '%';
                document.getElementById('productionRate').textContent = Math.round(latestMetrics.productionRate) + ' units/hr';
                document.getElementById('availabilityValue').textContent = latestMetrics.availability.toFixed(1) + '%';
                document.getElementById('qualityValue').textContent = latestMetrics.qualityRate.toFixed(1) + '%';
                
                this.renderMachineStatus(data.machines);
                this.renderAlerts(data.alerts);
            }

            renderProductionSection(data) {
                const latestMetrics = data.metrics[data.metrics.length - 1];
                document.getElementById('totalOutput').textContent = Math.round(latestMetrics.productionRate * 8); // 8-hour shift
                document.getElementById('avgCycleTime').textContent = (60 - (latestMetrics.oee - 70) / 25 * 15).toFixed(1) + 's';
                
                // Render production table
                const tbody = document.getElementById('productionTableBody');
                tbody.innerHTML = data.machines.map(machine => `
                    <tr>
                        <td>${machine.id}</td>
                        <td>${machine.currentProduct}</td>
                        <td>
                            <span class="status-indicator ${machine.health > 0.7 ? 'status-optimal' : machine.health > 0.4 ? 'status-warning' : 'status-critical'}"></span>
                            ${machine.status}
                        </td>
                        <td>${(machine.efficiency * 100).toFixed(1)}%</td>
                        <td>${Math.round(machine.output)}</td>
                        <td>${(machine.health * 100).toFixed(1)}%</td>
                        <td>${machine.issues.length > 0 ? machine.issues[0] : 'None'}</td>
                    </tr>
                `).join('');
            }

            renderQualitySection(data) {
                document.getElementById('firstPassYield').textContent = data.quality.overallFirstPassYield.toFixed(1) + '%';
                document.getElementById('defectRate').textContent = data.quality.overallDefectRate.toFixed(1) + '%';
                document.getElementById('qualityScore').textContent = (100 - data.quality.overallDefectRate).toFixed(0);
                document.getElementById('inspectionTime').textContent = '45s';
                
                // Render quality table
                const tbody = document.getElementById('qualityTableBody');
                tbody.innerHTML = data.quality.inspections.slice(0, 10).map(inspection => `
                    <tr>
                        <td>${inspection.id}</td>
                        <td>${inspection.product}</td>
                        <td>${inspection.inspected}</td>
                        <td>${inspection.passed}</td>
                        <td>${inspection.defects}</td>
                        <td>${inspection.defectRate.toFixed(1)}%</td>
                        <td>${inspection.inspector}</td>
                    </tr>
                `).join('');
            }

            renderPredictiveSection(data) {
                document.getElementById('productionForecast').textContent = Math.round(data.metrics[data.metrics.length - 1].productionRate * 1.1 * 24 * 7) + ' units';
                document.getElementById('demandPrediction').textContent = Math.round(data.products.reduce((sum, p) => sum + p.demand, 0) * 1.05);
            }

            renderMaintenanceSection(data) {
                document.getElementById('mtbfValue').textContent = data.maintenance.mtbf.toFixed(0) + 'h';
                document.getElementById('maintenanceCost').textContent = '$' + data.maintenance.costPerMonth.toLocaleString();
                
                // Render maintenance schedule
                const container = document.getElementById('maintenanceSchedule');
                container.innerHTML = data.maintenance.schedules.map(schedule => `
                    <div class="schedule-item">
                        <div>
                            <strong>${schedule.machineId}</strong>
                            <div>${schedule.task}</div>
                        </div>
                        <div>
                            <div>Due: ${Math.round((new Date(schedule.dueDate) - new Date()) / (1000 * 60 * 60 * 24))} days</div>
                            <div class="kpi-trend ${schedule.priority === 'High' ? 'trend-down' : schedule.priority === 'Medium' ? 'trend-up' : ''}">
                                ${schedule.priority} priority
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            renderEnergySection(data) {
                document.getElementById('gridPower').textContent = data.energy.current.gridPower.toFixed(0) + ' kWh';
                document.getElementById('solarPower').textContent = data.energy.current.solarPower.toFixed(0) + ' kWh';
                document.getElementById('batteryLevel').textContent = data.energy.current.batteryLevel.toFixed(0) + '%';
                document.getElementById('energyEfficiency').textContent = data.energy.current.efficiency.toFixed(0) + '%';
                
                // Render energy table
                const tbody = document.getElementById('energyTableBody');
                tbody.innerHTML = data.machines.map(machine => `
                    <tr>
                        <td>${machine.name}</td>
                        <td>${machine.powerRating} kW</td>
                        <td>${(machine.powerRating * 8).toFixed(0)} kWh</td>
                        <td>$${(machine.powerRating * 8 * 0.12).toFixed(2)}</td>
                        <td>${(machine.efficiency * 100).toFixed(1)}%</td>
                    </tr>
                `).join('');
            }

            renderLogisticsSection(data) {
                document.getElementById('agvCount').textContent = data.logistics.agvs.filter(a => a.status === 'Active').length;
                document.getElementById('materialFlow').textContent = data.logistics.materialFlow.toFixed(0) + '/hr';
                
                // Render inventory table
                const tbody = document.getElementById('inventoryTableBody');
                tbody.innerHTML = data.logistics.inventory.map(item => `
                    <tr>
                        <td>${item.material}</td>
                        <td>${item.currentStock.toLocaleString()}</td>
                        <td>${item.location}</td>
                        <td>${item.replenishment}</td>
                        <td>
                            <span class="status-indicator ${
                                item.status === 'Adequate' ? 'status-optimal' : 
                                item.status === 'Low' ? 'status-warning' : 'status-critical'
                            }"></span>
                            ${item.status}
                        </td>
                    </tr>
                `).join('');
            }

            renderMachineStatus(machines) {
                const container = document.getElementById('machineStatusContainer');
                container.innerHTML = machines.map(machine => `
                    <div class="machine-status">
                        <div class="machine-icon">‚öôÔ∏è</div>
                        <div class="machine-info">
                            <div class="machine-name">${machine.name} (${machine.id})</div>
                            <div class="machine-stats">
                                <span>Eff: ${(machine.efficiency * 100).toFixed(1)}%</span>
                                <span>Temp: ${machine.temperature.toFixed(1)}¬∞C</span>
                                <span>Health: ${(machine.health * 100).toFixed(1)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ${machine.health > 0.7 ? 'progress-optimal' : machine.health > 0.4 ? 'progress-warning' : 'progress-critical'}" 
                                     style="width: ${machine.health * 100}%"></div>
                            </div>
                        </div>
                        <div class="machine-output">${Math.round(machine.output)} units</div>
                    </div>
                `).join('');
            }

            renderAlerts(alerts) {
                const container = document.getElementById('alertsContainer');
                container.innerHTML = alerts.slice(0, 3).map(alert => `
                    <div class="alert ${alert.type === 'warning' ? 'alert-warning' : 'alert-critical'}">
                        <span class="status-indicator ${alert.type === 'warning' ? 'status-warning' : 'status-critical'}"></span>
                        ${alert.message} (${new Date(alert.timestamp).toLocaleTimeString()})
                    </div>
                `).join('');
            }
        }

        // Initialize the complete application
        document.addEventListener('DOMContentLoaded', () => {
            new CompleteDigitalTwinUI();
        });
    </script>
</body>
</html>